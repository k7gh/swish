**Build & Push the Docker image**

```
docker build -t kedjah/python:v0.1 -f python.Dockerfile .

docker push kedjah/python:v0.1

```

**Checking package versions**

1. Python2 (already installed on ubuntu)

```
$ docker run -it kedjah/python:v0.1 python2 --version
Python 2.7.18
```

2. Python3

```
$ docker run -it kedjah/python:v0.1 python3 --version
Python 3.8.10
```
3. R Version

```
$ docker run -it kedjah/python:v0.1 R --version
R version 3.6.3 (2020-02-29) -- "Holding the Windsock"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under the terms of the
GNU General Public License versions 2 or 3.
For more information about these matters see
https://www.gnu.org/licenses/.

```
**Checking Build times**

```
$ time docker build -t kedjah/python:v0.1 -f python.Dockerfile .
Sending build context to Docker daemon  6.144kB
Step 1/10 : FROM ubuntu:20.04
20.04: Pulling from library/ubuntu
edaedc954fb5: Pull complete 
Digest: sha256:33a5cc25d22c45900796a1aca487ad7a7cb09f09ea00b779e3b2026b4fc2faba
Status: Downloaded newer image for ubuntu:20.04
 ---> 6df894023726
Step 2/10 : USER root
 ---> Running in 23da05c693c9
Removing intermediate container 23da05c693c9
 ---> cd751894093d
Step 3/10 : ENV DEBIAN_FRONTEND noninteractive
...
...
...
...
Removing intermediate container 8adb7afb3b17
 ---> 0a04d9b67383
Successfully built 0a04d9b67383
Successfully tagged kedjah/python:v0.1

real	3m32.995s
user	0m0.462s
sys	0m0.253s
```


Build times can be improved by restructing the commands a little bit to install dependencies in the same apt-get command.
```
time docker build -t kedjah/python:v0.2 -f v2-python.Dockerfile .

Sending build context to Docker daemon  9.216kB
Step 1/8 : FROM ubuntu:20.04
 ---> 6df894023726
Step 2/8 : USER root
 ---> Using cache
 ---> cd751894093d
Step 3/8 : ENV DEBIAN_FRONTEND noninteractive
 ---> Using cache
... 
...
...
...
Removing intermediate container 64b254b8305c
 ---> e6da4ec4ca2a
Successfully built e6da4ec4ca2a
Successfully tagged kedjah/python:v0.2

real	3m13.444s
user	0m0.252s
sys	0m0.212s

```
We can also leverage scratch images and build cache to improve build times further.

**CVE Scanning and Mitigation**

A trivy CVE scan report can be generated by running the following command:

```
trivy image -f json -o trivy-scan-results.json kedjah/python:v0.1
```
The CVEs found in the process can be mitigated by either removing the imapacted package (if it not being used) or by updating the package version to the one which does not have the CVE. CVE management is an ongoing process since new CVEs get reported all the time. We can also use scratch base images which would limit the number of packages installed in the final image therefore reducing the number of CVEs

**Kubernetes manifest and service**

1. deployment.yaml can be used to run the image and the command will keep it running forever
2. service.yaml will expose port 80 & 443 on the container. Although no service is running on it. 

**CI/CD**

I would recommend creating a helm-chart of the service and then deploying it using ArgoCD as described in the next section.

**Monitoring**

The above deployment can be monitored by the monitoring system we talk about in the next section.
